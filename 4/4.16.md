# 4.16. Erstellung eines PDF-Dokumentes für ein gesamtes Werk

{% hint style="danger" %}
**Translation needed:** Please notice that the following paragraph need an English translation. The text gets updated over the next weeks.
{% endhint %}

Dieses Plugin erstellt ein PDF-Dokument für einen Goobi-Vorgang und speichert es im Dateisystem ab. Für das Inhaltsverzeichnis wird dabei die Struktur der METS-Datei des Goobi-Vorgangs verwendet, für die Seiteninhalte die in der METS-Datei referenzierten Bilddateien.

Je nach Konfiguration können - sofern vorhanden – auch bereits existierende Einzelseiten-PDFs für die Erzeugung des Gesamt-PDFs verwendet werden. Damit geht die Erstellung des PDFs erheblich schneller, da keine Konvertierung stattfinden muss, und Volltexte aus den Einzelseiten-PDFs übernommen werden können.

Alternativ können Volltexte auch aus ALTO-Dokumenten in das PDF geschrieben werden. Dies ist ebenso bei der Erstellung aus Einzelseiten-PDFs möglich, wird jedoch unterdrückt, wenn diese bereits Volltexte beinhalten.

## Starting the plugin

Die Erstellung eines PDFs wird über den TaskClient durch den Aufruf angestoßen:

```bash
/usr/bin/java -jar /opt/digiverso/itm/bin/TaskClient.jar 
    -itm http://localhost:8080/itm/service 
    -s {processpath} 
    -d {processpath}/ocr/{processtitle}_pdf 
    -e 
    -i {stepid} 
    -T {processtitle} 
    -t PdfCreation 
    -n template 
    -gid {processid}
```

## Parameters

The command parameters are explained in the following table:

| Parameter | Possible Goobi variable | Meaning |
| :--- | :--- | :--- |
| `-itm` | `http://localhost/itm/service` | URL to intranda TaskManager interface |
| `-e`, `--returnError` | - | If entered, the TaskClient will end with an error code to prevent the workflow from continuing automatically |
| `-p` | `0 – 10` | Priority to execute this job |
| `-gid` | `{processid}` | Goobi process ID |
| `-i` | `{stepid}` | ID for the workflow step that launches the call |
| `-T`, `--title` | `{processtitle}` | Goobi process title for which the call is launched |
| `-t`, `--jobtype` | `PdfCreation` | Job type |
| `-n`, `--templatename` | `template` | This parameter is not used by the plugin. |
| `-s`, `--source` | `{processpath}` | Path to the folder containing the ABBYY XML files |
| `-d`, `--destination` | `{processpath}/ocr/{processtitle}_pdf` | Path to the folder in which the ebook is to be stored |

{% hint style="danger" %}
**Translation needed:** Please notice that the following paragraph need an English translation. The text gets updated over the next weeks.
{% endhint %}

Einzelseiten-PDFs und ALTO-Dateien werden aus dem Unterordner `ocr` des source-Ordners - innerhalb dessen sich die Datei `meta.xml` befindet - aus den Unterordnern `<Vorgangsname>_pdf` bzw. `<Vorgangsname>_alto` geladen. Die Dateien müssen, bis auf die Endung, so benannt sein wie die Bilddateien in der METS-Datei.

Ist der Zielordner, in den die PDF-Datei geschrieben wird, identisch mit dem Ordner der Einzelseiten-PDFs, so wird letzterer umbenannt in `<Vorgangsname>_pdf_abbyy`.

## Configuration of the plugin

{% hint style="danger" %}
**Translation needed:** Please notice that the following paragraph need an English translation. The text gets updated over the next weeks.
{% endhint %}

Das Plugin kann ohne eigene Konfigurationsdatei verwendet werden. In diesem Fall werden, sofern vorhanden, Einzelseiten-PDFs und Volltext-ALTO-Dateien für die Erstellung verwendet. Für alle weiteren Parameter der PDF-Erstellung wird die von Goobi bereitgestellte intrandaContentServer Konfigurationsdatei verwendet.

Sollte ein anderes Verhalten gewünscht sein, so muss folgende Konfigurationsdatei angelegt werden:

```bash
/opt/digiverso/itm/config/pdfCreationConfig.xml
```

Diese Datei hat folgenden Inhalt:

```markup
<config_plugin>
    <usePdfDirectory>[true/false]</usePdfDirectory>
    <useAltoDirectory>[true/false]</useAltoDirectory>
    <contentServerConfigPath>
        /path/to/my/content/server/config.xml
    </contentServerConfigPath>
</config_plugin>
```

Mit dem Parameter `usePdfDirectory` lässt sich die Verwendung von Einzelseiten-PDFs an bzw. abschalten; mit dem Parameter `useAltoDirectory` die Verwendung von ALTO-Dateien zur Integrierung von Volltexten.

Der Parameter `contentServerConfigPath` kann verwendet werden, um einen Pfad zu einer alternativen ContentServer-Konfiguration anzugeben, falls ein anderes Verhalten erwünscht ist als für die PDF-Erzeugung in Goobi.

## Stopping the plugin

{% hint style="danger" %}
**Translation needed:** Please notice that the following paragraph need an English translation. The text gets updated over the next weeks.
{% endhint %}

Nach dem Stoppen des Plugins wird eine gerade laufende PDF-Erzeugung beendet, bevor das Plugin beendet wird. In der Warteschlange verbleibende Jobs werden anschließend nach dem Neustart des Plugins bearbeitet.

Die Erzeugung des PDFs erfolgt im TaskManager-Plugin. Beendet man also den TaskManager selbst, wird die Erzeugung sofort abgebrochen. Der Job ist dann jedoch weder in der Warteliste, noch gilt er als beendet oder abgebrochen. Der Job muss in diesem Fall manuell abgebrochen und erneut gestartet werden.

