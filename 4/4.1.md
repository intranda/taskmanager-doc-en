# 4.1.  Plugin: JPEG-2000-Generation with Lurawave

This plugin sends data to the Lurawave JPEG 2000 converter service. 

## Starting the plugin

To start the plugin, Goobi issues a command such as the one shown below:

```bash
/usr/bin/java -jar /opt/digiverso/taskmanager/bin/TaskClient.jar 
    -itm http://localhost:8080/itm/service 
    -d {imagepath} 
    -s {origpath} 
    -e -i {stepid} 
    -T {processtitle} 
    -t LURAWAVE 
    -n config_rate10.xml 
    -gid {processid}
```

## Parameters

The command parameters are explained in the following table:

| Parameter | Possible Goobi variable | Meaning |
| :--- | :--- | :--- |
| `-itm` | `http://localhost:8080/itm/service` | URL zur Schnittstelle des intranda TaskManagers |
| `-e`, `--returnError` | `-` | Wenn angegeben, beendet sich der TaskClient mit einem Fehlercode, um das automatische Fortschreiten im Workflow zu unterbinden |
| `-p` | `0 – 10` | Priorität zur Verarbeitung dieses Jobs |
| `-gid` | `{processid}` | ID des Goobi-Vorgangs |
| `-i` | `{stepid}` | Die ID des Arbeitsschrittes, der den Aufruf startet |
| `-T`, `--title` | `{processtitle}` | Der Vorgangstitel in Goobi, für den der Aufruf gestartet wird |
| `-t`, `--jobtype` | `LURAWAVE` | Der Typ des Jobs |
| `-n`, `--templatename` | `config_rate10.xml` | Name der zu verwendenden Konfigurationsdatei |
| `-s`, `--source` | `{origpath}` | Pfad zum master Verzeichnis des Vorgangs |
| `-d`, `--destination` | `{imagepath}` | Pfad zum images Verzeichnis des Vorgangs |

## Operation of the plugin

Nachdem ein Lurawave Job erzeugt wurde, wird ein Ordner im Input-Ordner des Lurawave- Services erzeugt, der lokal \(z.B. unter `/mnt/lurawave/`\) eingemounted ist. Dieser Ordner heißt `_temp_(interne ID)_{processtitle}`. In diesen Ordner wir die Konfigurationsdatei sowie alle TIFF-Bilder kopiert. Danach wird der Prefix `_temp_` des Ordnernamens entfernt. Dies ist ein Zeichen für Lurawave, mit der Konvertierung zu beginnen.

Der intranda Task Manager überwacht nun den Lurawave-Output Ordner auf das Vorhandensein eines Ordners desselben Namens. Wird der Ordner gefunden, werden die erzeugten JP2 Bilder während der Download-Phase in den entsprechenden Unterordner des `destination`-Ordners verschoben.

